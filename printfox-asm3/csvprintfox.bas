#RetroDevStudio.MetaData.BASIC:7169,BASIC V7.0,uppercase,10,10
# THIS PROGRAM READS CSV FILES WITH COMPETITION RANKINGS OF ONE DISCIPLINE
# FROM THAT IT GENERATES PRINTFOX TEXT FILES (FT)
# ONE PAGE CONTAINS ALL THE POINTS AND RANKS
# OTHER PAGES CONTAIN PLAYER NAMES AND POSITIONS



2 S1=TI:FAST:GRAPHIC1:GRAPHIC0:GRAPHIC5:BANK15:POKE 57,0:POKE58,39:CLR
4 DD=PEEK(186)

# BASIC END (CONTAINS COMPRESSED GB FILE)
6 BE=PEEK(4624)+PEEK(4625)*256

# VARIABLE END (CONTAINS UNCOMPRESSED GB FILES)
8 VE=PEEK(57)+PEEK(58)*256

10 PRINT "BASIC END (COMPRESSED GB):"BE
12 PRINT "VARIABLE END (UNCOMP. GB):"VE

25 PN$="":FM=0:TF=0:FF=0:SB=0:SA=0:DB=0:DA=0:FE=0:EA=0:PM=31:DM=6
26 DIM IM(DM),PN$(DM,PM),PS(DM,PM)


100 DIM FI$(99),DT$(50,3)

110 INPUT "COMPETITION-ID (3 CHARS)";CI$
120 IF LEN(CI$)>3 THEN CI$=LEFT$(CI$,3)
130 INPUT "DISCIPLINE-ID (3 CHARS)";DI$
140 IF LEN(DI$)>3 THEN DI$=LEFT$(DI$,3)
145 IF LEN(DI$)=0 THEN 999

150 FI$=CI$+"-"+DI$+".FT"

160 PRINT FRE(0) FRE(1)

170 OPEN 1,DD,2,"WERTNG"+CI$+DI$+".CSV,P,R"
172 IF DS<>0 THEN PRINT DS$" FILE "FI$:CLOSE1:END
180 X=0:DO

190  INPUT#1,DT$(X,0),DT$(X,1),DT$(X,2)
200  IF LEFT$(DT$(X,0),1)=CHR$(10) THEN DT$(X,0)=MID$(DT$(X,0),2)

#205  PRINT "X="X"$"DT$(X,0)"$"DT$(X,1)"$"DT$(X,2)"$"DT$(X,3)

210  X=X+1
220 LOOP UNTIL ST>=64
230 CLOSE 1
240 PRINT "CSV LOADED. "X" ENTRIES READ."
250 IM(0)=X-1
260 GOSUB 6000


# WRITE TF FILES FOR SCORELIST, NAMES, RANKS

500 OPEN1,DD,2,"@0:"+FI$+",P,W"

# WRITE
#  START OF FILE (84)
#  FORMATLINE (02)
#  COMMENT "C" ABOUT WHAT'S IN THE FILE

510 PRINT#1,CHR$(84);

520 T$=CHR$(02)+"C SCORES "+DI$+CHR$(13):GOSUB6100:PRINT#1,T2$;

530 Y2=740-IM(0)*11:Y1=Y2-20:
540 Y1$=MID$(STR$(Y1),2)
550 Y2$=MID$(STR$(Y2),2)

560 T$=CHR$(02)+"Z=162 S=0 X=72 L=560 Y="+Y1$+CHR$(13):GOSUB6100:PRINT#1,T2$;
570 T$="IE UNKTE IM ]BERBLICK"+CHR$(13):GOSUB6100:PRINT#1,T2$;

580 T$=CHR$(02)+"Z=161 T=20,150 Y="+Y2$+" X=72 L=560"+CHR$(13):GOSUB6100:PRINT#1,T2$;

590 FOR X=0 TO IM(0)-1
600  T$=DT$(X,0)+CHR$(7)+DT$(X,1)+CHR$(7)+DT$(X,2)+CHR$(13)
610  PRINT#1,T$;
620 NEXT

630 FOR X=0 TO IM(0)-1:PRINT#1,CHR$(13)+CHR$(1);
640  T$=CHR$(2)+"Z=162 Y=305 S=2"+CHR$(13):GOSUB6100:PRINT#1,T2$;
650  T$="ER PIELER"+CHR$(13):GOSUB6100:PRINT#1,T2$
660  T$=CHR$(2)+"Z=177 Y=325 S=2"+CHR$(13):GOSUB6100:PRINT#1,T2$;
670  PRINT#1,DT$(X,1)+CHR$(13);
680 NEXT


690 PRINT#1,CHR$(0)CHR$(0);
700 CLOSE 1

710 GOTO 130


999 END



##########
# TO PETSCII-UPPERCASE
###########
6000 REM
6005 FOR X=0 TO IM(CD)-1
6010  T$=DT$(X,1):T2$=""
6020  FOR TX=1 TO LEN(T$)
6030   C$=MID$(T$,TX,1):C=ASC(C$)
6040   IF C>=96 THEN IF C<=122 THEN T2$=T2$+CHR$(C-32):ELSE T2$=T2$+C$
6050  NEXT
6060  DT$(X,3)=T2$
6070 NEXT
6080 RETURN


# TO ASCII
6100 T2$=""
6110 FOR TX=1 TO LEN(T$)
6120  C$=MID$(T$,TX,1):C=ASC(C$)
6130  IF C>=65 THEN IF C<=91 THEN T2$=T2$+CHR$(C+32):GOTO 6050
6140  IF C>=193 THEN IF C<=218 THEN T2$=T2$+CHR$(C-128):GOTO 6050
6150  T2$=T2$+C$
6160 NEXT

6180 RETURN