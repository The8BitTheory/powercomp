#RetroDevStudio.MetaData.BASIC:7169,BASIC V7.0,uppercase,10,10
#########################
# THIS ORS TWO GB FILES #
#########################

# SOURCE IMAGES RESIDE IN BANK 1
# DEST IMAGE IS WRITTEN TO BANK 0


4 GRAPHIC0:SLOW:BANK15:POKE 57,0:POKE58,5:CLR:PRINT FRE(0) FRE(1)
5 DD=PEEK(186)


# THE MC-COMPILED ROUTINE TO UNCOMPRESS GB FROM BE TO VE

# BASIC END (CONTAINS COMPRESSED GB FILE)
10 BE=PEEK(4624)+PEEK(4625)*256

# VARIABLE END (CONTAINS UNCOMPRESSED GB FILES)
12 VE=PEEK(57)+PEEK(58)*256

14 PRINT "BASIC END (COMPRESSED GB):"BE
16 PRINT "VARIABLE END (UNCOMP. GB):"VE

20 DEF FN HB(ZZ)=INT(ZZ/256)
21 DEF FN LB(ZZ)=ZZ-INT(ZZ/256)*256

# SETUP VDC CHIP
#30 ::RGO DEC("19"),128:REM BITMAP MODE
#32 ::RGA DEC("19"),191:REM NO ATTRIBUTES
#34 ::RGO DEC("1C"),16:REM 64KB VRAM
#35 RGW 8,3:RGW4,64:RGW6,50:RGW7,58:RGW0,128

#36 VMF 0,0,65535


100 FI$="MERGED2.GB":SB=0:SA=BE:GOSUB 2000
130 PRINT "DONE.":PRINT "FREE MEM:"FRE(0) FRE(1)



260 PRINT "LOADING GBPACK.BIN...";:BLOAD"GBPACK.BIN",B0,U(DD):PRINT "DONE"

# SOURCE BANK: 996
# SOURCE START ADDRESS (COMP GB):997/998

262 POKE 996,SB
264 POKE 997,FNLB(SA):POKE 998,FNHB(SA)

# DEST BANK: 999
# DEST START ADDRESS (UNCOMP GB):1000/1001
266 POKE 999,1
268 POKE 1000,FNLB(VE):POKE 1001,FNHB(VE)




270 PRINT "PACKING...";:FAST:S=TI:SYS DEC("1300"):S=TI-S:SLOW
275 PRINT "DONE. TOOK "S" JIFFIES"

276 EA=PEEK(1002)+PEEK(1003)*256
278 PRINT "PACKED GB FROM "VE" TO "EA

285 BSAVE"@PACKED.GB",B1,P(VE) TO P(EA),U(DD)



999 BANK15:GRAPHIC0:END




#############################
# LOAD GB FILE TO BASIC-END #
#############################
2000 PRINT "LOADING "FI$" TO B"SB",AD"SA;
2005 DOPEN #1,U(DD),(FI$),R
2010 GET#1,A$,B$
2020 DCLOSE #1

2030 IF A$<>"G" THEN PRINT FI$" IS NOT A GB FILE":END

# LOAD BINARY FILE. LEAVE TWO BYTES EMPTY AND MANUALLY POKE THE VALUES (BLOAD SKIPS THESE)
2040 BLOAD (FI$),B(SB),P(SA+2),U(DD)
2041 PRINT "DONE"


# FILE END (END OF COMPRESSED GB FILE
2042 FE=PEEK(174)+PEEK(175)*256
2044 PRINT "FILE END:"FE


2050 BANK SB
2052 POKE SA,ASC(A$):POKE SA+1,ASC(B$)
2054 BANK 15



2070 RETURN


