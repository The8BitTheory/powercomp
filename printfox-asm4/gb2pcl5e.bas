#RetroDevStudio.MetaData.BASIC:7169,BASIC V7.0,uppercase,10,10
9 POKE58,128:CLR:GRAPHIC5
10 DD=PEEK(186)
11 DEFFNHB(ZZ)=INT(ZZ/256)
12 DEFFNLB(ZZ)=ZZ-INT(ZZ/256)*256
13 E$=CHR$(27):AR$=E$+CHR$(42)+CHR$(114):FF$=CHR$(12):AB$=E$+CHR$(42)+CHR$(98)

14 HD$=E$+CHR$(69)
15 HD$=HD$+E$+CHR$(38)+CHR$(108)+CHR$(50)+CHR$(65)
16 HD$=HD$+AR$+CHR$(48)+CHR$(70)
17 HD$=HD$+AR$+CHR$(55)+CHR$(53)+CHR$(82)
18 HD$=HD$+AR$+CHR$(48)+CHR$(65)

19 VE=PEEK(57)+PEEK(58)*256
20 PRINT"LOADING FOX2VDC.BIN...";:BLOAD"FOX2VDC.BIN",B0,U(DD):PRINT"DONE"
25 PRINT"LOADING PCL5ERL.BIN...";:BLOAD"PCL5ERL.BIN",B0,U(DD):PRINT"DONE"
30 BE=PEEK(4624)+PEEK(4625)*256
100 GOSUB800
105 D=0:DC=0
145 DO
150 GETKEYI$
171 IFI$="D"THENCATALOGU(DD)
172 IFI$="L"THENGOSUB200
173 IFI$="H"THENGOSUB800
174 IFI$="U"THENINPUTDU$:DD=VAL(DU$):POKE186,DD
180 LOOPUNTILI$="X"
190 END
200 INPUT"FILENAME";FI$
210 REM FI$="24SUM-RS-01.GB1"
220 SB=1:SA=VE:GOSUB2000
230 DB=0:DA=BE:GOSUB1000
240 IFECTHENEC=0:GOTO320
250 A=DA
251 IFA$="P"THENGOSUB 3000

260 FAST

261 POKE56579,255

262 PRINT "SENDING HEADER...";
264 BW$=HD$
265 GOSUB 500
269 PRINT"DONE"

#   DEFINE GRAPHICLINE ESC SEQUENCE
270 BW$=AB$+MID$(STR$(NC),2)+"W"

271 PRINT "GRAPHICLINE:"BW$
272 PRINT "SENDING DATA"

273 BL=NR*8-1
274 FOR R=0 TO BL
275  SYS DEC("1A00"),FNLB(A),FNHB(A),FNLB(NC)
#275  GOSUB500
#285  FORCO=1TONC
#286   PRINT".";
#287   V=PEEK(A):GOSUB400:A=A+1
280  A=A+NC
289  NEXT

290  PRINT
300 NEXT

302 BW$=AR$+"C":GOSUB500
305 V=12:GOSUB400

310 SLOW
320 GOSUB800
330 RETURN

#   SEND SINGLE BYTE
400 POKE56577,V
401 POKE56576,PEEK(56576)AND(255-4)
402 POKE56576,PEEK(56576)OR4
403 RETURN

#   SEND FORMAT DATA
500 BL=LEN(BW$)
505 FORC=1TOBL

515  POKE56577,ASC(MID$(BW$,C,1))
520  POKE56576,PEEK(56576)AND(255-4)
525  POKE56576,PEEK(56576)OR4

530 NEXT
540 RETURN

800 PRINT"D: DISPLAY DIRECTORY"
810 PRINT"L: LOAD FILE"
820 PRINT"U: CHANGE DRIVE"
830 PRINT"X: EXIT TO BASIC"
840 RETURN
999 END
1000 POKE996,SB
1040 POKE997,FNLB(SA):POKE998,FNHB(SA)
1050 POKE999,PEEK(174):POKE1000,PEEK(175)
1060 POKE1001,DB
1070 POKE1002,FNLB(DA):POKE1003,FNHB(DA)
1080 V=DA+NC*NR*8:REM PRINT "UNCOMPRESSING TO: B"DB",DA"DA" - "(DA+NC*NR*8);
1081 IFV>65200THENPRINT"FILE TOO LARGE:"NR"X"NC" - "V:SLOW:EC=-1:GOTO1099
1090 FAST:S=TI:SYSDEC("1300"):S=TI-S:SLOW
1092 REM PRINT "DONE. TOOK "S" JIFFIES"
1099 RETURN
2000 PRINT"LOADING "FI$" TO B"SB",AD"SA;
2005 DOPEN#1,U(DD),(FI$),R
2010 GET#1,A$,B$
2020 DCLOSE#1
2030 IFA$="G"THENNC=80:NR=50
2032 IFA$="B"THENNC=40:NR=25
2034 IFA$="P"THENNR=ASC(B$)
2040 BLOAD(FI$),B(SB),P(SA+2),U(DD)
2041 PRINT"DONE."
2042 FE=PEEK(174)+PEEK(175)*256
2044 PRINT "FILE END:"FE
2050 BANKSB
2052 POKESA,ASC(A$):POKESA+1,ASC(B$)
2053 IFA$="P"THENNC=PEEK(SA+2)
2054 BANK15
2060 PRINT "FORMAT "A$",COLS "NC",ROWS "NR
2070 RETURN
3000 A=A+1:PRINT"CHECK DATA BEGIN FROM "A
3010 V=PEEK(A):IF V=0 THEN A=A+1:PRINT"FOUND AT"A:RETURN
3020 GOTO 3000
